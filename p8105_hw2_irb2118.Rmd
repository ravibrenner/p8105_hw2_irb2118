---
title: "P8105 - HW2"
output: github_document
date: "Due: 2024-10-02"
---

Author: Ravi Brenner (irb2118)

# Introduction
This Rmarkdown document is for P8105 - Data Science 1, homework 2.

# Methods
The data for this homework comes from the course website, but all files can be found in the `data/` folder. Additionally, we will be using packages from the `tidyverse` and `readxl`.

```{r, message = FALSE}
library(tidyverse)
library(readxl)
```


# Problems

## Problem 1

This problem is about the NYC subway system.

First, we must read in the data, clean up the column names, and select and transform the columns that we need:

```{r}
subway_df <-
  read_csv("data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") |>
  janitor::clean_names() |>
  select(
    line,
    station_name,
    station_latitude,
    station_longitude,
    route1:route11,
    entry,
    vending,
    entrance_type,
    ada
  ) |>
  mutate(entry = case_match(entry,
                            "YES" ~ TRUE,
                            "NO" ~ FALSE))
```

This dataset contains data on each entrance and exit for each subway line and station (name and geographic location), and the routes that operate at the line and station (for example, some stops accomodate multiple trains on the same line, like the NQRW or the 123). There are additional variables indicating the entrance type, presence of vending machines, and ADA compliance.

So far, I imported the data using `read_csv`, cleaned up the column names using `janitor::clean_names`, selected the relevant columns using `select`, and transformed the `entry` column from character to logical. After these steps, there are `r nrow(subway_df)` rows and `r ncol(subway_df)` columns. 



#### How many distinct stations are there? 
```{r}
subway_df |>
  distinct(line,station_name) |>
  nrow()
```

There are 465 distinct stations.

#### How many stations are ADA compliant?
```{r}
subway_df |>
  filter(ada == TRUE) |>
  distinct(line,station_name) |>
  nrow()
```

84 stations are ADA compliant.

#### What proportion of station entrances / exits without vending allow entrance?
```{r}
subway_df |>
  filter(vending == "NO") |>
  janitor::tabyl(entry)
```

37.7% of station entrances without vending allow entrance.


Now, I will reformat the data from wide to long, into proper tidy format:
```{r}
subway_df <- subway_df |>
  mutate(across(.cols = route8:route11,
                as.character)) |>
  pivot_longer(cols = route1:route11,
               names_to = "route_number",
               values_to = "route_name",
               names_prefix = "route") |>
  drop_na(route_name)
```

#### How many distinct stations serve the A train? 
```{r}
subway_df |>
  filter(route_name == "A") |>
  distinct(line,station_name) |>
  nrow()
```

60 distinct stations serve the A train.

#### Of the stations that serve the A train, how many are ADA compliant?
```{r}
subway_df |>
  filter(route_name == "A") |>
  distinct(line,station_name,ada) |>
  janitor::tabyl(ada)
```

17/60 stations that serve the A train, or 28.3%, are ADA compliant.

## Problem 2

First we have to read in and clean the data for Mr. Trash Wheel. Then we will follow a similar process for Professor Trash Wheel and Gwynnda, and eventually combine them all into one tidy data set. First, Mr. Trash Wheel:

```{r}
mr_trash_wheel <- read_excel("data/202309 Trash Wheel Collection Data.xlsx",
                             sheet = "Mr. Trash Wheel",
                             range = "A2:N586") |>
  janitor::clean_names() |>
  mutate(sports_balls = as.integer(sports_balls),
         year = as.numeric(year),
         name = "mr_trash_wheel") 
```

And repeat the same process for Professor Trash Wheel and Gwynnda Trash Wheel:
```{r}
prof_trash_wheel <- read_excel("data/202309 Trash Wheel Collection Data.xlsx",
                             sheet = "Professor Trash Wheel",
                             range = "A2:M108") |>
  janitor::clean_names() |>
  mutate(name = "prof_trash_wheel")

gwyn_trash_wheel <- read_excel("data/202309 Trash Wheel Collection Data.xlsx",
                             sheet = "Gwynnda Trash Wheel",
                             range = "A2:L157") |>
  janitor::clean_names() |>
  mutate(name = "gwyn_trash_wheel")
```

Now, combining all the datasets:

```{r}
trash_wheels <- bind_rows(mr_trash_wheel,prof_trash_wheel,gwyn_trash_wheel)
```

With these 3 trash wheel datasets combined, there are `r nrow(trash_wheels)` rows 
(`r nrow(mr_trash_wheel)` for Mr. Trash Wheel, `r nrow(prof_trash_wheel)` for Professor Trash Wheel, and `r nrow(gwyn_trash_wheel)` for Gwynnda Trash Wheel) 
and `r ncol(trash_wheels)` columns. 

Observations range from `r min(pull(trash_wheels, date))` to `r max(pull,trash_wheels,date))`, and there were `r sum(pull(trash_wheels,cigarette_butts))` cigarette butts collected in that period!


## Problem 3

# Conclusion